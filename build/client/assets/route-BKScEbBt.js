import{r as w,j as e}from"./index-Bhhhx7h4.js";import{u as b}from"./useUserContext-ltZQ69X3.js";import{A as l}from"./index-CWUlnviP.js";import{S as N}from"./provider-RLEbTht8.js";import{I as E}from"./index-CH34cjkL.js";import{u as M}from"./index-CeUTncnb.js";import{T as k,B as x}from"./index-C7Q2D2Yy.js";import{C as u}from"./index-cPgcPs25.js";import{R as A,C as U}from"./row-B-zWIMNx.js";import{s}from"./index-BzyPBYP5.js";import{P as f}from"./index-C6x-598G.js";import"./Dropdown-EsR9A278.js";import"./index-BHyeewtM.js";import"./EllipsisOutlined-Bce2vzrs.js";import"./responsiveObserver-CzlRrsiN.js";const{Title:h,Text:a}=k;function _(){const i=M(),{user:t,isLoggedIn:y,checkRole:n}=b(),{data:c,isLoading:j}=l.course.findMany.useQuery({}),{data:L}=l.subscription.findFirst.useQuery({where:{userId:t==null?void 0:t.id}}),{data:o,isLoading:m}=l.premiumLink.findFirst.useQuery(void 0,{retry:!1}),p=n(["ADMIN","PREMIUM"]),v=async()=>{try{o!=null&&o.url?window.location.href=o.url:i("/upgrade")}catch(r){console.error("Error handling upgrade:",r),s.error("Failed to process upgrade request. Please try again."),i("/upgrade")}},[C,g]=w.useState(!1),{mutateAsync:I}=l.userCourse.create.useMutation(),P=async r=>{if(!y){s.warning("Please login to join courses"),i("/login");return}if(r.isPremium&&!n(["ADMIN","PREMIUM"])){s.warning("This is a premium course. Please upgrade your subscription to access."),i(`/courses/${r.id}/preview`);return}g(!0);try{await I({data:{courseId:r.id,userId:t.id}}),s.success("Successfully enrolled in course"),i(`/courses/${r.id}`)}catch(d){d.code==="NOT_FOUND"?s.error("Course not found"):d.code==="CONFLICT"?s.error("You are already enrolled in this course"):d.code==="FORBIDDEN"?s.error("Premium subscription required for course enrollment"):s.error("You are already enrolled in this course")}finally{g(!1)}};return j?e.jsx(f,{layout:"full-width",children:e.jsx("div",{style:{textAlign:"center",padding:"50px"},children:e.jsx(N,{size:"large"})})}):e.jsx(f,{layout:"full-width",children:e.jsxs("div",{style:{maxWidth:"1200px",margin:"0 auto",padding:"20px"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"40px"},children:[e.jsxs(h,{level:2,children:[e.jsx("i",{className:"las la-play-circle"})," Course Library"]}),e.jsx(a,{children:"Explore our collection of premium courses. Upgrade your account to access all content."})]}),!p&&!n("ADMIN")&&e.jsxs(u,{style:{marginBottom:"24px",textAlign:"center",background:"#f0f7ff"},children:[e.jsxs(h,{level:4,children:[e.jsx("i",{className:"las la-crown"})," Unlock All Premium Content"]}),e.jsx(a,{children:"Get unlimited access to all our premium courses and exclusive content."}),e.jsx("div",{style:{marginTop:"16px"},children:e.jsx(x,{type:"primary",size:"large",onClick:v,loading:m,children:m?"Loading...":"Upgrade Now"})})]}),e.jsx(A,{gutter:[24,24],children:c==null?void 0:c.map(r=>e.jsx(U,{xs:24,sm:12,md:8,lg:8,children:e.jsx(u,{hoverable:!0,cover:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(E.Img,{src:r.previewUrl,srcOnError:"/images/course-fallback.jpg",isPretty:!0,styleWrapper:{position:"relative",maxWidth:"100%",height:"auto",aspectRatio:"16/9"},styleImg:{objectFit:"cover",objectPosition:"center",width:"100%",height:"100%"}}),e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("i",{className:"las la-play-circle",style:{fontSize:"48px",color:"#1890ff"}})})]}),actions:[e.jsx(x,{type:"",block:!0,onClick:()=>P(r),loading:C,style:{backgroundColor:"#000000",color:"#ffffff"},children:"Join Course"},"watch")],children:e.jsx(u.Meta,{title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[r.title,r.isPremium&&e.jsx("i",{className:"las la-crown",style:{color:"#ffd700",fontSize:"18px"}})]}),description:e.jsxs(e.Fragment,{children:[e.jsx(a,{children:r.description}),r.isPremium&&!p&&e.jsx("div",{style:{marginTop:"8px"},children:e.jsxs(a,{type:"secondary",children:[e.jsx("i",{className:"las la-lock"})," Premium content"]})})]})})})},r.id))})]})})}export{_ as default};
