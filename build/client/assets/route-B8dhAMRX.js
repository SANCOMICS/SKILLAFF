import{r as c,j as e}from"./index-Bhhhx7h4.js";import{u as W}from"./useUserContext-CjczNUYd.js";import{A as o,T as k}from"./index-D9_lrgu6.js";import{F as r,I as i}from"./index-IivWOIOz.js";import{R as S,C as f}from"./row-DHszOpHb.js";import{C as y}from"./index-ydtyDG1o.js";import{B as b}from"./button-DgkAoqE2.js";import{F as T}from"./Table-CsxigRTB.js";import{M as j}from"./index-DUqLeMFK.js";import{s as n}from"./index-DaEJ5rVL.js";import{P as v}from"./index-ufwEpZVH.js";import"./index-Bs36QOeU.js";import"./pickAttrs-r0RFaJBP.js";import"./SearchOutlined-CdaQ9A1C.js";import"./collapse-BbEVqHco.js";import"./ExclamationCircleFilled-CiuxUjGk.js";import"./responsiveObserver-Cz69L87y.js";import"./Dropdown-DVbf8yOU.js";import"./index-CeoCv33H.js";import"./CloseOutlined-Dxm4jkL9.js";import"./EllipsisOutlined-D3hTA01Z.js";import"./Pagination-DseZJcil.js";import"./LeftOutlined-R_ycQdco.js";import"./useBreakpoint-D4cuiZ4X.js";import"./index-Hz7ZMWx3.js";import"./index-rKHRpc2j.js";import"./Sider-C8x-a6eO.js";import"./index-Bjxa92qe.js";import"./index-_rPoQdzz.js";import"./useClosable-CCDYGg12.js";import"./fade-2t19LHl3.js";const{Title:g,Text:B}=k;function ce(){const{user:s}=W(),[l]=r.useForm(),[w,m]=c.useState(!1),[F,d]=c.useState(!1),[I,h]=c.useState(!1),[u]=r.useForm(),{data:p,refetch:x}=o.wallet.findFirst.useQuery({where:{userId:s==null?void 0:s.id}}),{data:M}=o.transaction.findMany.useQuery({where:{userId:s==null?void 0:s.id},orderBy:{createdAt:"desc"}}),{mutateAsync:P}=o.billing.initiateDeposit.useMutation(),{mutateAsync:A}=o.billing.processWithdrawal.useMutation(),D=async t=>{h(!0);try{await P({amount:t.amount,phoneNumber:t.phoneNumber}),d(!1),u.resetFields(),x(),n.success("Dépôt Mobile Money initié avec succès")}catch(a){n.error(a.message)}finally{h(!1)}},C=async t=>{try{await A({amount:t.amount,phoneNumber:t.phoneNumber}),n.success("Mobile Money withdrawal processed successfully"),l.resetFields(),m(!1),x()}catch(a){n.error(a.message||"Failed to process withdrawal")}},N=[{title:"Type",dataIndex:"type",key:"type"},{title:"Amount",dataIndex:"amount",key:"amount",render:t=>`XAF ${t}`},{title:"Status",dataIndex:"status",key:"status"},{title:"Date",dataIndex:"createdAt",key:"createdAt",render:t=>new Date(t).toLocaleDateString()}];return e.jsxs(v,{children:[e.jsxs(S,{gutter:[24,24],children:[e.jsx(f,{xs:24,children:e.jsxs(y,{children:[e.jsx(g,{level:3,children:"Wallet Balance"}),e.jsxs(B,{strong:!0,style:{fontSize:24},children:["XAF ",(p==null?void 0:p.balance)||"0.00"]}),e.jsxs("div",{style:{marginTop:24},children:[e.jsx(b,{type:"primary",onClick:()=>d(!0),style:{marginRight:16},children:"Deposit Funds"}),e.jsx(b,{onClick:()=>m(!0),children:"Withdraw Funds"})]})]})}),e.jsx(f,{xs:24,children:e.jsxs(y,{children:[e.jsx(g,{level:3,children:"Transaction History"}),e.jsx(T,{columns:N,dataSource:M,rowKey:"id",pagination:{pageSize:10}})]})})]}),e.jsx(j,{title:"Mobile Money Deposit",open:F,onOk:()=>u.submit(),onCancel:()=>d(!1),okButtonProps:{loading:I},children:e.jsxs(r,{form:u,onFinish:D,children:[e.jsx(r.Item,{name:"amount",label:"Amount",rules:[{required:!0,message:"Please enter deposit amount"},{pattern:/^\d+$/,message:"Please enter a valid amount"},{validator:(t,a)=>a&&parseInt(a)<=0?Promise.reject("Amount must be greater than 0"):Promise.resolve()}],children:e.jsx(i,{prefix:"XAF"})}),e.jsx(r.Item,{name:"phoneNumber",label:"Phone Number",rules:[{required:!0,message:"Please enter phone number"},{pattern:/^(237|\\+237)?[6-9][0-9]{8}$/,message:"Please enter a valid Cameroon phone number"}],children:e.jsx(i,{addonBefore:"+237"})})]})}),e.jsx(j,{title:"Withdraw Funds",open:w,onOk:()=>l.submit(),onCancel:()=>m(!1),children:e.jsxs(r,{form:l,onFinish:C,children:[e.jsx(r.Item,{name:"amount",label:"Amount",rules:[{required:!0,message:"Please enter withdrawal amount"},{pattern:/^\d+$/,message:"Please enter a valid amount"}],children:e.jsx(i,{prefix:"NGN"})}),e.jsx(r.Item,{name:"phoneNumber",label:"Phone Number",rules:[{required:!0,message:"Please enter phone number"},{pattern:/^(237|\\+237)?[6-9][0-9]{8}$/,message:"Please enter a valid Cameroon phone number"}],children:e.jsx(i,{addonBefore:"+237"})})]})})]})}export{ce as default};
