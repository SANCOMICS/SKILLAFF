import{r as p,j as e}from"./index-Bhhhx7h4.js";import{u as W}from"./useUserContext-ltZQ69X3.js";import{A as o}from"./index-CWUlnviP.js";import"./provider-RLEbTht8.js";import{F as s,I as n}from"./index-C8qbBouM.js";import{R as k,C as f}from"./row-B-zWIMNx.js";import{C as y}from"./index-cPgcPs25.js";import{T as S,B as b}from"./index-C7Q2D2Yy.js";import{F as T}from"./Table-D46c5F71.js";import{M as j}from"./index-CzA3G1Dw.js";import{s as i}from"./index-BzyPBYP5.js";import{P as v}from"./index-C6x-598G.js";import"./SearchOutlined-ADv_U9mc.js";import"./collapse-BbEVqHco.js";import"./responsiveObserver-CzlRrsiN.js";import"./Dropdown-EsR9A278.js";import"./index-BHyeewtM.js";import"./EllipsisOutlined-Bce2vzrs.js";import"./Pagination-D2AnF2UC.js";import"./useBreakpoint-CiMsAa-F.js";import"./index-LQraNpB7.js";import"./index-B0p7av3r.js";import"./index-DqVK0OKb.js";import"./useClosable-Bdp6jF3W.js";import"./fade-BYpxbwFh.js";const{Title:g,Text:B}=S;function ie(){const{user:r}=W(),[l]=s.useForm(),[w,m]=p.useState(!1),[F,d]=p.useState(!1),[I,h]=p.useState(!1),[u]=s.useForm(),{data:c,refetch:x}=o.wallet.findFirst.useQuery({where:{userId:r==null?void 0:r.id}}),{data:M}=o.transaction.findMany.useQuery({where:{userId:r==null?void 0:r.id},orderBy:{createdAt:"desc"}}),{mutateAsync:P}=o.billing.initiateDeposit.useMutation(),{mutateAsync:A}=o.billing.processWithdrawal.useMutation(),D=async t=>{h(!0);try{await P({amount:t.amount,phoneNumber:t.phoneNumber}),d(!1),u.resetFields(),x(),i.success("Dépôt Mobile Money initié avec succès")}catch(a){i.error(a.message)}finally{h(!1)}},C=async t=>{try{await A({amount:t.amount,phoneNumber:t.phoneNumber}),i.success("Mobile Money withdrawal processed successfully"),l.resetFields(),m(!1),x()}catch(a){i.error(a.message||"Failed to process withdrawal")}},N=[{title:"Type",dataIndex:"type",key:"type"},{title:"Amount",dataIndex:"amount",key:"amount",render:t=>`XAF ${t}`},{title:"Status",dataIndex:"status",key:"status"},{title:"Date",dataIndex:"createdAt",key:"createdAt",render:t=>new Date(t).toLocaleDateString()}];return e.jsxs(v,{children:[e.jsxs(k,{gutter:[24,24],children:[e.jsx(f,{xs:24,children:e.jsxs(y,{children:[e.jsx(g,{level:3,children:"Wallet Balance"}),e.jsxs(B,{strong:!0,style:{fontSize:24},children:["XAF ",(c==null?void 0:c.balance)||"0.00"]}),e.jsxs("div",{style:{marginTop:24},children:[e.jsx(b,{type:"primary",onClick:()=>d(!0),style:{marginRight:16},children:"Deposit Funds"}),e.jsx(b,{onClick:()=>m(!0),children:"Withdraw Funds"})]})]})}),e.jsx(f,{xs:24,children:e.jsxs(y,{children:[e.jsx(g,{level:3,children:"Transaction History"}),e.jsx(T,{columns:N,dataSource:M,rowKey:"id",pagination:{pageSize:10}})]})})]}),e.jsx(j,{title:"Mobile Money Deposit",open:F,onOk:()=>u.submit(),onCancel:()=>d(!1),okButtonProps:{loading:I},children:e.jsxs(s,{form:u,onFinish:D,children:[e.jsx(s.Item,{name:"amount",label:"Amount",rules:[{required:!0,message:"Please enter deposit amount"},{pattern:/^\d+$/,message:"Please enter a valid amount"},{validator:(t,a)=>a&&parseInt(a)<=0?Promise.reject("Amount must be greater than 0"):Promise.resolve()}],children:e.jsx(n,{prefix:"XAF"})}),e.jsx(s.Item,{name:"phoneNumber",label:"Phone Number",rules:[{required:!0,message:"Please enter phone number"},{pattern:/^(237|\\+237)?[6-9][0-9]{8}$/,message:"Please enter a valid Cameroon phone number"}],children:e.jsx(n,{addonBefore:"+237"})})]})}),e.jsx(j,{title:"Withdraw Funds",open:w,onOk:()=>l.submit(),onCancel:()=>m(!1),children:e.jsxs(s,{form:l,onFinish:C,children:[e.jsx(s.Item,{name:"amount",label:"Amount",rules:[{required:!0,message:"Please enter withdrawal amount"},{pattern:/^\d+$/,message:"Please enter a valid amount"}],children:e.jsx(n,{prefix:"NGN"})}),e.jsx(s.Item,{name:"phoneNumber",label:"Phone Number",rules:[{required:!0,message:"Please enter phone number"},{pattern:/^(237|\\+237)?[6-9][0-9]{8}$/,message:"Please enter a valid Cameroon phone number"}],children:e.jsx(n,{addonBefore:"+237"})})]})})]})}export{ie as default};
