import{r as P,j as e}from"./index-Bhhhx7h4.js";import{u as b}from"./useUserContext-CjczNUYd.js";import{A as o,T as w}from"./index-D9_lrgu6.js";import{I as N}from"./index-CH34cjkL.js";import{u as k}from"./index-CeUTncnb.js";import{S as E}from"./index-_rPoQdzz.js";import{C as d}from"./index-ydtyDG1o.js";import{B as g}from"./button-DgkAoqE2.js";import{R as L,C as M}from"./row-DHszOpHb.js";import{s as i}from"./index-DaEJ5rVL.js";import{P as x}from"./index-ufwEpZVH.js";import"./index-Bs36QOeU.js";import"./Dropdown-DVbf8yOU.js";import"./index-CeoCv33H.js";import"./CloseOutlined-Dxm4jkL9.js";import"./EllipsisOutlined-D3hTA01Z.js";import"./responsiveObserver-Cz69L87y.js";import"./ExclamationCircleFilled-CiuxUjGk.js";import"./pickAttrs-r0RFaJBP.js";const{Title:f,Text:a}=w;function X(){const s=k(),{user:t,isLoggedIn:y,checkRole:n}=b(),{data:l,isLoading:h}=o.course.findMany.useQuery({}),{data:A}=o.subscription.findFirst.useQuery({where:{userId:t==null?void 0:t.id}}),{data:U,isLoading:m}=o.premiumLink.findFirst.useQuery(void 0,{retry:!1}),u=n(["ADMIN","PREMIUM"]),j=async()=>{try{s("/upgrade")}catch(r){console.error("Error handling upgrade:",r),i.error("Failed to process upgrade request. Please try again."),s("/upgrade")}},[v,p]=P.useState(!1),{mutateAsync:C}=o.userCourse.create.useMutation(),I=async r=>{if(!y){i.warning("Please login to join courses"),s("/login");return}if(r.isPremium&&!n(["ADMIN","PREMIUM"])){i.warning("This is a premium course. Please upgrade your subscription to access."),s(`/courses/${r.id}/preview`);return}p(!0);try{await C({data:{courseId:r.id,userId:t.id}}),i.success("Successfully enrolled in course"),s(`/courses/${r.id}`)}catch(c){c.code==="NOT_FOUND"?i.error("Course not found"):c.code==="CONFLICT"?i.error("You are already enrolled in this course"):c.code==="FORBIDDEN"?i.error("Premium subscription required for course enrollment"):i.error("You are already enrolled in this course")}finally{p(!1)}};return h?e.jsx(x,{layout:"full-width",children:e.jsx("div",{style:{textAlign:"center",padding:"50px"},children:e.jsx(E,{size:"large"})})}):e.jsx(x,{layout:"full-width",children:e.jsxs("div",{style:{maxWidth:"1200px",margin:"0 auto",padding:"20px"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"40px"},children:[e.jsxs(f,{level:2,children:[e.jsx("i",{className:"las la-play-circle"})," Course Library"]}),e.jsx(a,{children:"Explore our collection of premium courses. Upgrade your account to access all content."})]}),!u&&!n("ADMIN")&&e.jsxs(d,{style:{marginBottom:"24px",textAlign:"center",background:"#f0f7ff"},children:[e.jsxs(f,{level:4,children:[e.jsx("i",{className:"las la-crown"})," Unlock All Premium Content"]}),e.jsx(a,{children:"Get unlimited access to all our premium courses and exclusive content."}),e.jsx("div",{style:{marginTop:"16px"},children:e.jsx(g,{type:"primary",size:"large",onClick:j,loading:m,children:m?"Loading...":"Upgrade Now"})})]}),e.jsx(L,{gutter:[24,24],children:l==null?void 0:l.map(r=>e.jsx(M,{xs:24,sm:12,md:8,lg:8,children:e.jsx(d,{hoverable:!0,cover:e.jsxs("div",{style:{position:"relative"},children:[e.jsx(N.Img,{src:r.previewUrl,srcOnError:"/images/course-fallback.jpg",isPretty:!0,styleWrapper:{position:"relative",maxWidth:"100%",height:"auto",aspectRatio:"16/9"},styleImg:{objectFit:"cover",objectPosition:"center",width:"100%",height:"100%"}}),e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("i",{className:"las la-play-circle",style:{fontSize:"48px",color:"#1890ff"}})})]}),actions:[e.jsx(g,{type:"",block:!0,onClick:()=>I(r),loading:v,style:{backgroundColor:"#000000",color:"#ffffff"},children:"Join Course"},"watch")],children:e.jsx(d.Meta,{title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[r.title,r.isPremium&&e.jsx("i",{className:"las la-crown",style:{color:"#ffd700",fontSize:"18px"}})]}),description:e.jsxs(e.Fragment,{children:[e.jsx(a,{children:r.description}),r.isPremium&&!u&&e.jsx("div",{style:{marginTop:"8px"},children:e.jsxs(a,{type:"secondary",children:[e.jsx("i",{className:"las la-lock"})," Premium content"]})})]})})})},r.id))})]})})}export{X as default};
